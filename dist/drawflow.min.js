!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Drawflow=t():e.Drawflow=t()}("undefined"!=typeof self?self:this,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>n});class n{constructor(e,t=null){this.events={},this.container=e,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.checkInOutType=!1,this.singleConnectionForTypedInput=!1,this.select_elements=null,this.noderegister={},this.render=t,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=[],this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(e){this.evCache.push(e)}pointermove_handler(e){for(var t=0;t<this.evCache.length;t++)if(e.pointerId==this.evCache[t].pointerId){this.evCache[t]=e;break}if(2==this.evCache.length){var n=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(n>this.prevDiff&&this.zoom_in(),n<this.prevDiff&&this.zoom_out()),this.prevDiff=n}}pointerup_handler(e){this.remove_event(e),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(e){for(var t=0;t<this.evCache.length;t++)if(this.evCache[t].pointerId==e.pointerId){this.evCache.splice(t,1);break}}load(){for(let e in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[e],this.precanvas);if(this.reroute)for(let e in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[e]);for(let e in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+e);const e=this.drawflow.drawflow;let t=1;Object.keys(e).map((function(n,s){Object.keys(e[n].data).map((function(e,n){parseInt(e)>=t&&(t=parseInt(e)+1)}))})),this.nodeId=t}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach(((e,t)=>{e.classList.remove("selected")}))}click(e){if(this.dispatch("click",e),"fixed"===this.editor_mode){if("parent-drawflow"!==e.target.classList[0]&&"drawflow"!==e.target.classList[0])return!1;this.ele_selected=e.target.closest(".parent-drawflow")}else"view"===this.editor_mode?(null!=e.target.closest(".drawflow")||e.target.matches(".parent-drawflow"))&&(this.ele_selected=e.target.closest(".parent-drawflow"),e.preventDefault()):(this.first_click=e.target,this.ele_selected=e.target,0===e.button&&this.contextmenuDel(),null==e.target.closest(".output")&&null==e.target.closest(".input")&&null==e.target.closest(".connection")&&null!=e.target.closest(".drawflow-node")&&(this.ele_selected=e.target.closest(".drawflow-node")));switch(this.ele_selected.classList[0]){case"drawflow-node":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?"SELECT"!==e.target.tagName&&(this.drag=!0):"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"SELECT"!==e.target.tagName&&!0!==e.target.hasAttribute("contenteditable")&&(this.drag=!0);break;case"output":this.connection=!0,null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(e.target);break;case"parent-drawflow":case"drawflow":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const t=this.connection_selected.parentElement.classList;this.dispatch("connectionSelected",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach(((e,t)=>{e.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}"touchstart"===e.type?(this.pos_x=e.touches[0].clientX,this.pos_x_start=e.touches[0].clientX,this.pos_y=e.touches[0].clientY,this.pos_y_start=e.touches[0].clientY):(this.pos_x=e.clientX,this.pos_x_start=e.clientX,this.pos_y=e.clientY,this.pos_y_start=e.clientY),this.dispatch("clickEnd",e)}position(e){let t,n;if("touchmove"===e.type?(t=e.touches[0].clientX,n=e.touches[0].clientY):(t=e.clientX,n=e.clientY),this.connection&&this.updateConnection(t,n),this.editor_selected){const e=this.canvas_x+-(this.pos_x-t),s=this.canvas_y+-(this.pos_y-n);this.dispatch("translate",{x:e,y:s}),this.precanvas.style.transform="translate("+e+"px, "+s+"px) scale("+this.zoom+")"}if(this.drag){const e=(this.pos_x-t)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),s=(this.pos_y-n)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=t,this.pos_y=n,this.ele_selected.style.top=this.ele_selected.offsetTop-s+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-e+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-e,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-s,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){this.pos_x=t,this.pos_y=n;var s=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),i=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",s),this.ele_selected.setAttributeNS(null,"cy",i);const e=this.ele_selected.parentElement.classList[2].slice(9),o=this.ele_selected.parentElement.classList[1].slice(13),l=this.ele_selected.parentElement.classList[3],c=this.ele_selected.parentElement.classList[4];let d=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(d-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,d<0&&(d=0));const a=e.slice(5),r=this.drawflow.drawflow[this.module].data[a].outputs[l].connections.findIndex((function(e,t){return e.node===o&&e.output===c}));this.drawflow.drawflow[this.module].data[a].outputs[l].connections[r].points[d]={pos_x:s,pos_y:i};const u=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(u)}"touchmove"===e.type&&(this.mouse_x=t,this.mouse_y=n),this.dispatch("mouseMove",{x:t,y:n})}dragEnd(e){let t,n,s;if(null!=this.select_elements&&(this.select_elements.remove(),this.select_elements=null),"touchend"===e.type?(t=this.mouse_x,n=this.mouse_y,s=document.elementFromPoint(t,n)):(t=e.clientX,n=e.clientY,s=e.target),this.drag&&(this.pos_x_start==t&&this.pos_y_start==n||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&this.ele_selected.classList.remove("selected"),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-t),this.canvas_y=this.canvas_y+-(this.pos_y-n),this.editor_selected=!1),!0===this.connection){let e,t;if("input"===s.classList[0]||this.force_first_input&&(null!=s.closest(".drawflow_content_node")||"drawflow-node"===s.classList[0])){!this.force_first_input||null==s.closest(".drawflow_content_node")&&"drawflow-node"!==s.classList[0]?(e=s.parentElement.parentElement.parentElement.id,t=s.classList[1]):(e=null!=s.closest(".drawflow_content_node")?s.closest(".drawflow_content_node").parentElement.id:s.id,t=0!==Object.keys(this.getNodeFromId(e.slice(5)).inputs).length&&"input_1");var i=this.ele_selected.parentElement.parentElement.parentElement.id,o=this.ele_selected.classList[1];if(i!==e&&!1!==t){if(0===this.container.querySelectorAll(".connection.node_in_"+e+".node_out_"+i+"."+o+"."+t).length){var l=e.slice(5),c=i.slice(5);if(this.checkInOutType&&this.checkConnectionTypes(l,t,c,o)||!this.checkInOutType){var d=!1;if(this.drawflow.drawflow[this.module].data[l].inputs[t].type&&this.singleConnectionForTypedInput&&this.container.querySelectorAll(".node_in_"+e+"."+t).length>0&&(d=!0),d)console.log("There is already an output linked to the input: "+t+" for node: "+l),this.dispatch("connectionCancel",!0),this.connection_ele.remove();else{this.connection_ele.classList.add("node_in_"+e),this.connection_ele.classList.add("node_out_"+i),this.connection_ele.classList.add(o),this.connection_ele.classList.add(t),this.connection_ele.setAttribute("type",this.drawflow.drawflow[this.module].data[c].outputs[o].type),this.drawflow.drawflow[this.module].data[c].outputs[o].connections.push({node:l,output:t}),this.drawflow.drawflow[this.module].data[l].inputs[t].connections.push({node:c,input:o});var a=document.querySelector("#"+i+" ."+o);a&&!a.classList.contains("linked")&&a.classList.add("linked");var r=document.querySelector("#"+e+" ."+t);r&&!r.classList.contains("linked")&&r.classList.add("linked"),this.updateConnectionNodes("node-"+c),this.updateConnectionNodes("node-"+l),this.dispatch("connectionCreated",{output_id:c,input_id:l,output_class:o,input_class:t})}}else console.log("Input and output type don't match"),this.dispatch("connectionCancel",!0),this.connection_ele.remove()}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1}checkConnectionTypes(e,t,n,s){return this.drawflow.drawflow[this.module].data[n].outputs[s].type==this.drawflow.drawflow[this.module].data[e].inputs[t].type}contextmenu(e){if(this.dispatch("contextmenu",e),e.preventDefault(),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var t=document.createElement("div");t.classList.add("drawflow-delete"),t.innerHTML="x",this.node_selected&&this.node_selected.appendChild(t),this.connection_selected&&(t.style.top=e.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",t.style.left=e.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(t))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(e){if(this.dispatch("keydown",e),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;("Delete"===e.key||"Backspace"===e.key&&e.metaKey)&&(null!=this.node_selected&&"INPUT"!==this.first_click.tagName&&"TEXTAREA"!==this.first_click.tagName&&!0!==this.first_click.hasAttribute("contenteditable")&&this.removeNodeId(this.node_selected.id),null!=this.connection_selected&&this.removeConnection())}zoom_enter(e,t){e.ctrlKey&&(e.preventDefault(),e.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){1!=this.zoom&&(this.zoom=1,this.zoom_refresh())}createCurvature(e,t,n,s,i,o){var l=e,c=t,d=n,a=s,r=i;let u,h;switch(o){case"open":return e>=n?(u=l+Math.abs(d-l)*r,h=d-Math.abs(d-l)*(-1*r)):(u=l+Math.abs(d-l)*r,h=d-Math.abs(d-l)*r)," M "+l+" "+c+" C "+u+" "+c+" "+h+" "+a+" "+d+"  "+a;case"close":return e>=n?(u=l+Math.abs(d-l)*(-1*r),h=d-Math.abs(d-l)*r):(u=l+Math.abs(d-l)*r,h=d-Math.abs(d-l)*r)," M "+l+" "+c+" C "+u+" "+c+" "+h+" "+a+" "+d+"  "+a;case"other":return e>=n?(u=l+Math.abs(d-l)*(-1*r),h=d-Math.abs(d-l)*(-1*r)):(u=l+Math.abs(d-l)*r,h=d-Math.abs(d-l)*r)," M "+l+" "+c+" C "+u+" "+c+" "+h+" "+a+" "+d+"  "+a;default:return u=l+Math.abs(d-l)*r,h=d-Math.abs(d-l)*r," M "+l+" "+c+" C "+u+" "+c+" "+h+" "+a+" "+d+"  "+a}}drawConnection(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=t;var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.classList.add("main-path"),n.setAttributeNS(null,"d",""),t.classList.add("connection"),t.appendChild(n),this.precanvas.appendChild(t);var s=e.parentElement.parentElement.parentElement.id.slice(5),i=e.classList[1];t.setAttribute("type",this.drawflow.drawflow[this.module].data[s].outputs[i].type),this.dispatch("connectionStart",{output_id:s,output_class:i})}updateConnection(e,t){const n=this.precanvas,s=this.zoom;let i=n.clientWidth/(n.clientWidth*s);i=i||0;let o=n.clientHeight/(n.clientHeight*s);o=o||0;var l=this.connection_ele.children[0],c=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-n.getBoundingClientRect().x)*i,d=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-n.getBoundingClientRect().y)*o,a=e*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),r=t*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),u=this.curvature,h=this.createCurvature(c,d,a,r,u,"openclose");l.setAttributeNS(null,"d",h)}addConnection(e,t,n,s){var i=this.getModuleFromNodeId(e);if(i===this.getModuleFromNodeId(t)){var o=this.getNodeFromId(e),l=!1;for(var c in o.outputs[n].connections){var d=o.outputs[n].connections[c];d.node==t&&d.output==s&&(l=!0)}if(!1===l&&(this.drawflow.drawflow[i].data[e].outputs[n].connections.push({node:t.toString(),output:s}),this.drawflow.drawflow[i].data[t].inputs[s].connections.push({node:e.toString(),input:n}),this.module===i))if(this.checkInOutType&&this.checkConnectionTypes(t,s,e,n)||!this.checkInOutType){var a=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.classList.add("main-path"),r.setAttributeNS(null,"d",""),a.classList.add("connection"),a.classList.add("node_in_node-"+t),a.classList.add("node_out_node-"+e),a.classList.add(n),a.classList.add(s),a.setAttribute("type",this.drawflow.drawflow[this.module].data[e].outputs[n].type),a.appendChild(r);var u=document.querySelector("#node-"+e+" ."+n);u&&!u.classList.contains("linked")&&u.classList.add("linked");var h=document.querySelector("#node-"+t+" ."+s);h&&!h.classList.contains("linked")&&h.classList.add("linked"),this.precanvas.appendChild(a),this.updateConnectionNodes("node-"+e),this.updateConnectionNodes("node-"+t),this.dispatch("connectionCreated",{output_id:e,input_id:t,output_class:n,input_class:s})}else console.log("Input "+t+s+" and ouput "+e+n+" types don't match")}}updateConnectionNodes(e){const t="node_in_"+e,n="node_out_"+e,s=this.container,i=this.precanvas,o=this.curvature,l=this.createCurvature,c=this.reroute_curvature,d=this.reroute_curvature_start_end,a=this.reroute_fix_curvature,r=this.reroute_width,u=this.zoom;let h=i.clientWidth/(i.clientWidth*u);h=h||0;let p=i.clientHeight/(i.clientHeight*u);p=p||0;const m=s.querySelectorAll(`.${n}`);Object.keys(m).map((function(t,n){if(null===m[t].querySelector(".point")){var f=s.querySelector(`#${e}`),g=m[t].classList[1].replace("node_in_",""),_=s.querySelector(`#${g}`).querySelectorAll("."+m[t].classList[4])[0],w=_.offsetWidth/2+(_.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,v=_.offsetHeight/2+(_.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,y=f.querySelectorAll("."+m[t].classList[3])[0],C=y.offsetWidth/2+(y.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,L=y.offsetHeight/2+(y.getBoundingClientRect().y-i.getBoundingClientRect().y)*p;const n=l(C,L,w,v,o,"openclose");m[t].children[0].setAttributeNS(null,"d",n)}else{const n=m[t].querySelectorAll(".point");let o="";const f=[];n.forEach(((t,a)=>{if(0===a&&n.length-1==0){let n=s.querySelector(`#${e}`),c=t,a=(c.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,u=(c.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,m=n.querySelectorAll("."+t.parentElement.classList[3])[0],g=m.offsetWidth/2+(m.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,_=m.offsetHeight/2+(m.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,w=a,v=u,y=l(g,_,w,v,d,"open");o+=y,f.push(y),n=t;let C=t.parentElement.classList[1].replace("node_in_",""),L=s.querySelector(`#${C}`);c=L.querySelectorAll("."+t.parentElement.classList[4])[0];let b=L.querySelectorAll("."+t.parentElement.classList[4])[0];a=b.offsetWidth/2+(b.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,u=b.offsetHeight/2+(b.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,g=(n.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,_=(n.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,w=a,v=u,y=l(g,_,w,v,d,"close"),o+=y,f.push(y)}else if(0===a){let u=s.querySelector(`#${e}`),m=t,g=(m.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,_=(m.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,w=u.querySelectorAll("."+t.parentElement.classList[3])[0],v=w.offsetWidth/2+(w.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,y=w.offsetHeight/2+(w.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,C=g,L=_,b=l(v,y,C,L,d,"open");o+=b,f.push(b),u=t,m=n[a+1],g=(m.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,_=(m.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,v=(u.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,y=(u.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,C=g,L=_,b=l(v,y,C,L,c,"other"),o+=b,f.push(b)}else if(a===n.length-1){let e=t,n=t.parentElement.classList[1].replace("node_in_",""),c=s.querySelector(`#${n}`),a=(c.querySelectorAll("."+t.parentElement.classList[4])[0],c.querySelectorAll("."+t.parentElement.classList[4])[0]),m=a.offsetWidth/2+(a.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,g=a.offsetHeight/2+(a.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,_=(e.getBoundingClientRect().x-i.getBoundingClientRect().x)*(i.clientWidth/(i.clientWidth*u))+r,w=(e.getBoundingClientRect().y-i.getBoundingClientRect().y)*(i.clientHeight/(i.clientHeight*u))+r,v=l(_,w,m,g,d,"close");o+=v,f.push(v)}else{let e=t,s=n[a+1],d=(s.getBoundingClientRect().x-i.getBoundingClientRect().x)*(i.clientWidth/(i.clientWidth*u))+r,h=(s.getBoundingClientRect().y-i.getBoundingClientRect().y)*(i.clientHeight/(i.clientHeight*u))+r,p=(e.getBoundingClientRect().x-i.getBoundingClientRect().x)*(i.clientWidth/(i.clientWidth*u))+r,m=(e.getBoundingClientRect().y-i.getBoundingClientRect().y)*(i.clientHeight/(i.clientHeight*u))+r,g=l(p,m,d,h,c,"other");o+=g,f.push(g)}})),a?f.forEach(((e,n)=>{m[t].children[n].setAttributeNS(null,"d",e)})):m[t].children[0].setAttributeNS(null,"d",o)}}));const f=s.querySelectorAll(`.${t}`);Object.keys(f).map((function(t,n){if(null===f[t].querySelector(".point")){var u=s.querySelector(`#${e}`),m=f[t].classList[2].replace("node_out_",""),g=s.querySelector(`#${m}`).querySelectorAll("."+f[t].classList[3])[0],_=g.offsetWidth/2+(g.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,w=g.offsetHeight/2+(g.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,v=(u=u.querySelectorAll("."+f[t].classList[4])[0]).offsetWidth/2+(u.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,y=u.offsetHeight/2+(u.getBoundingClientRect().y-i.getBoundingClientRect().y)*p;const n=l(_,w,v,y,o,"openclose");f[t].children[0].setAttributeNS(null,"d",n)}else{const n=f[t].querySelectorAll(".point");let o="";const u=[];n.forEach(((t,a)=>{if(0===a&&n.length-1==0){let n=s.querySelector(`#${e}`),c=t,a=(c.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,m=(c.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,f=n.querySelectorAll("."+t.parentElement.classList[4])[0],g=f.offsetWidth/2+(f.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,_=f.offsetHeight/2+(f.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,w=g,v=_,y=l(a,m,w,v,d,"close");o+=y,u.push(y),n=t;let C=t.parentElement.classList[2].replace("node_out_",""),L=s.querySelector(`#${C}`);c=L.querySelectorAll("."+t.parentElement.classList[3])[0];let b=L.querySelectorAll("."+t.parentElement.classList[3])[0];a=b.offsetWidth/2+(b.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,m=b.offsetHeight/2+(b.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,g=(n.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,_=(n.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,w=g,v=_,y=l(a,m,w,v,d,"open"),o+=y,u.push(y)}else if(0===a){let e=t,m=t.parentElement.classList[2].replace("node_out_",""),f=s.querySelector(`#${m}`),g=f.querySelectorAll("."+t.parentElement.classList[3])[0],_=f.querySelectorAll("."+t.parentElement.classList[3])[0],w=_.offsetWidth/2+(_.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,v=_.offsetHeight/2+(_.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,y=(e.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,C=(e.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,L=y,b=C,x=l(w,v,L,b,d,"open");o+=x,u.push(x),e=t,g=n[a+1],y=(g.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,C=(g.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,w=(e.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,v=(e.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,L=y,b=C,x=l(w,v,L,b,c,"other"),o+=x,u.push(x)}else if(a===n.length-1){let e=t,n=t.parentElement.classList[1].replace("node_in_",""),c=s.querySelector(`#${n}`),a=(c.querySelectorAll("."+t.parentElement.classList[4])[0],c.querySelectorAll("."+t.parentElement.classList[4])[0]),m=a.offsetWidth/2+(a.getBoundingClientRect().x-i.getBoundingClientRect().x)*h,f=a.offsetHeight/2+(a.getBoundingClientRect().y-i.getBoundingClientRect().y)*p,g=(e.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,_=(e.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,w=l(g,_,m,f,d,"close");o+=w,u.push(w)}else{let e=t,s=n[a+1],d=(s.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,m=(s.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,f=(e.getBoundingClientRect().x-i.getBoundingClientRect().x)*h+r,g=(e.getBoundingClientRect().y-i.getBoundingClientRect().y)*p+r,_=l(f,g,d,m,c,"other");o+=_,u.push(_)}})),a?u.forEach(((e,n)=>{f[t].children[n].setAttributeNS(null,"d",e)})):f[t].children[0].setAttributeNS(null,"d",o)}}))}dblclick(e){if(null!=this.connection_selected&&this.reroute&&this.createReroutePoint(this.connection_selected),"point"===e.target.classList[0]&&this.removeReroutePoint(e.target),"title-box"===e.target.classList[0]){var t=e.target.closest(".drawflow-node");this.dispatch("dblclick",t.id.slice(5))}}createReroutePoint(e){this.connection_selected.classList.remove("selected");const t=this.connection_selected.parentElement.classList[2].slice(9),n=this.connection_selected.parentElement.classList[1].slice(13),s=this.connection_selected.parentElement.classList[3],i=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.classList.add("point");var l=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),c=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));o.setAttributeNS(null,"cx",l),o.setAttributeNS(null,"cy",c),o.setAttributeNS(null,"r",this.reroute_width);let d=0;if(this.reroute_fix_curvature){const t=e.parentElement.querySelectorAll(".main-path").length;var a=document.createElementNS("http://www.w3.org/2000/svg","path");if(a.classList.add("main-path"),a.setAttributeNS(null,"d",""),e.parentElement.insertBefore(a,e.parentElement.children[t]),1===t)e.parentElement.appendChild(o);else{const n=Array.from(e.parentElement.children).indexOf(e);d=n,e.parentElement.insertBefore(o,e.parentElement.children[n+t+1])}}else e.parentElement.appendChild(o);const r=t.slice(5),u=this.drawflow.drawflow[this.module].data[r].outputs[s].connections.findIndex((function(e,t){return e.node===n&&e.output===i}));void 0===this.drawflow.drawflow[this.module].data[r].outputs[s].connections[u].points&&(this.drawflow.drawflow[this.module].data[r].outputs[s].connections[u].points=[]),this.reroute_fix_curvature?(d>0?this.drawflow.drawflow[this.module].data[r].outputs[s].connections[u].points.splice(d,0,{pos_x:l,pos_y:c}):this.drawflow.drawflow[this.module].data[r].outputs[s].connections[u].points.push({pos_x:l,pos_y:c}),e.parentElement.querySelectorAll(".main-path").forEach(((e,t)=>{e.classList.remove("selected")}))):this.drawflow.drawflow[this.module].data[r].outputs[s].connections[u].points.push({pos_x:l,pos_y:c}),this.dispatch("addReroute",r),this.updateConnectionNodes(t)}removeReroutePoint(e){const t=e.parentElement.classList[2].slice(9),n=e.parentElement.classList[1].slice(13),s=e.parentElement.classList[3],i=e.parentElement.classList[4];let o=Array.from(e.parentElement.children).indexOf(e)-1;const l=t.slice(5),c=this.drawflow.drawflow[this.module].data[l].outputs[s].connections.findIndex((function(e,t){return e.node===n&&e.output===i}));if(this.reroute_fix_curvature){const t=e.parentElement.querySelectorAll(".main-path").length;e.parentElement.children[t-1].remove(),o-=t,o<0&&(o=0)}this.drawflow.drawflow[this.module].data[l].outputs[s].connections[c].points.splice(o,1),e.remove(),this.dispatch("removeReroute",l),this.updateConnectionNodes(t)}registerNode(e,t,n=null,s=null){this.noderegister[e]={html:t,props:n,options:s}}getNodeFromId(e){var t=this.getModuleFromNodeId(e);return JSON.parse(JSON.stringify(this.drawflow.drawflow[t].data[e]))}getNodesFromName(e){var t=[];const n=this.drawflow.drawflow;return Object.keys(n).map((function(s,i){for(var o in n[s].data)n[s].data[o].name==e&&t.push(n[s].data[o].id)})),t}addNode(e,t,n,s,i,o,l,c,d=!1){var a;a=this.useuuid?this.getUuid():this.nodeId;const r=document.createElement("div");r.classList.add("parent-node");const u=document.createElement("div");u.innerHTML="",u.setAttribute("id","node-"+a),u.classList.add("drawflow-node"),""!=o&&u.classList.add(o);const h=document.createElement("div");h.innerHTML=c.header?c.header:"",h.classList.add("drawflow-node-header");const p=document.createElement("div");p.classList.add("drawflow-node-content");const m=document.createElement("div");m.classList.add("inputs");const f=document.createElement("div");f.classList.add("outputs");const g={};for(let e=0;e<t.length;e++){const n=t[e],s=document.createElement("div");s.classList.add("input"),s.classList.add("input_"+(e+1)),""!=n.type&&s.setAttribute("type",n.type),g["input_"+(e+1)]={label:n.label,type:n.type,connections:[]},m.appendChild(s);const i=document.createElement("div");i.classList.add("input-label"),i.classList.add("input-label_input_"+(e+1)),n.type&&i.setAttribute("type",n.type),n.label&&(i.innerHTML=n.label),m.appendChild(i)}const _={};for(let e=0;e<n.length;e++){const t=n[e],s=document.createElement("div");s.classList.add("output-label"),s.classList.add("output-label_output_"+(e+1)),t.type&&s.setAttribute("type",t.type),t.label&&(s.innerHTML=t.label),f.appendChild(s);const i=document.createElement("div");i.classList.add("output"),i.classList.add("output_"+(e+1)),t.type&&i.setAttribute("type",t.type),_["output_"+(e+1)]={label:t.label,type:t.type,connections:[]},f.appendChild(i)}const w=document.createElement("div");if(w.classList.add("drawflow_content_node"),!1===d)w.innerHTML=c.html;else if(!0===d)w.appendChild(this.noderegister[c.html].html.cloneNode(!0));else if(3===parseInt(this.render.version))this.render.createApp({render:e=>this.render.h(this.noderegister[c.html].html,this.noderegister[c.html].props,this.noderegister[c.html].options)}).mount(w);else{let e=new this.render({render:e=>e(this.noderegister[c.html].html,{props:this.noderegister[c.html].props}),...this.noderegister[c.html].options}).$mount();w.appendChild(e.$el)}function v(e,t,n){let s;s=null===e?l[t]:e[t],null!==s&&Object.entries(s).forEach((function(e,t){if("object"==typeof e[1])v(s,e[0],n+"-"+e[0]);else for(var i=w.querySelectorAll("[df-"+n+"-"+e[0]+"]"),o=0;o<i.length;o++)i[o].value=e[1]}))}Object.entries(l).forEach((function(e,t){if("object"==typeof e[1])v(null,e[0],e[0]);else for(var n=w.querySelectorAll("[df-"+e[0]+"]"),s=0;s<n.length;s++)n[s].value=e[1]}));const y=document.createElement("div");y.innerHTML=c.footer?c.footer:"",y.classList.add("drawflow-node-footer"),u.appendChild(h),u.appendChild(p),p.appendChild(m),p.appendChild(w),p.appendChild(f),u.appendChild(y),u.style.top=i+"px",u.style.left=s+"px",r.appendChild(u),this.precanvas.appendChild(r);var C={id:a,name:e,data:l,class:o,header:c.header,html:c.html,footer:c.footer,typenode:d,inputs:g,outputs:_,pos_x:s,pos_y:i};return this.drawflow.drawflow[this.module].data[a]=C,this.dispatch("nodeCreated",a),this.useuuid||this.nodeId++,a}addNodeImport(e,t){const n=document.createElement("div");n.classList.add("parent-node");const s=document.createElement("div");s.innerHTML="",s.setAttribute("id","node-"+e.id),s.classList.add("drawflow-node"),""!=e.class&&s.classList.add(e.class);const i=document.createElement("div");i.innerHTML=e.header?e.header:"",i.classList.add("drawflow-node-header");const o=document.createElement("div");o.classList.add("drawflow-node-content");const l=document.createElement("div");l.classList.add("inputs");const c=document.createElement("div");c.classList.add("outputs"),Object.keys(e.inputs).map((function(n,s){const i=document.createElement("div");i.classList.add("input"),i.classList.add(n),e.inputs[n].type&&i.setAttribute("type",e.inputs[n].type),e.inputs[n].connections.length>0&&i.classList.add("linked"),l.appendChild(i);const o=document.createElement("div");o.classList.add("input-label"),o.classList.add("input-label_input_"+(s+1)),e.inputs[n].type&&o.setAttribute("type",e.inputs[n].type),e.inputs[n].label&&(o.innerHTML=e.inputs[n].label),l.appendChild(o),Object.keys(e.inputs[n].connections).map((function(s,i){var o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.classList.add("main-path"),l.setAttributeNS(null,"d",""),o.classList.add("connection"),o.classList.add("node_in_node-"+e.id),o.classList.add("node_out_node-"+e.inputs[n].connections[s].node),o.classList.add(e.inputs[n].connections[s].input),o.classList.add(n),o.setAttribute("type",e.inputs[n].type),o.appendChild(l),t.appendChild(o)}))}));const d=document.createElement("div");d.classList.add("input-dummy"),l.appendChild(d),Object.keys(e.outputs).map((function(t,n){const s=document.createElement("div");s.classList.add("output-label"),s.classList.add("output-label_output_"+n++),e.outputs[t].type&&s.setAttribute("type",e.outputs[t].type),e.outputs[t].label&&(s.innerHTML=e.outputs[t].label),c.appendChild(s);const i=document.createElement("div");i.classList.add("output"),i.classList.add(t),e.outputs[t].type&&i.setAttribute("type",e.outputs[t].type),e.outputs[t].connections.length>0&&i.classList.add("linked"),c.appendChild(i)}));const a=document.createElement("div");a.classList.add("output-dummy"),c.appendChild(a);const r=document.createElement("div");if(r.classList.add("drawflow_content_node"),!1===e.typenode)r.innerHTML=e.html;else if(!0===e.typenode)r.appendChild(this.noderegister[e.html].html.cloneNode(!0));else if(3===parseInt(this.render.version))this.render.createApp({render:t=>this.render.h(this.noderegister[e.html].html,this.noderegister[e.html].props,this.noderegister[e.html].options)}).mount(r);else{let t=new this.render({render:t=>t(this.noderegister[e.html].html,{props:this.noderegister[e.html].props}),...this.noderegister[e.html].options}).$mount();r.appendChild(t.$el)}function u(t,n,s){let i;i=null===t?e.data[n]:t[n],null!==i&&Object.entries(i).forEach((function(e,t){if("object"==typeof e[1])u(i,e[0],s+"-"+e[0]);else for(var n=r.querySelectorAll("[df-"+s+"-"+e[0]+"]"),o=0;o<n.length;o++)n[o].value=e[1]}))}Object.entries(e.data).forEach((function(e,t){if("object"==typeof e[1])u(null,e[0],e[0]);else for(var n=r.querySelectorAll("[df-"+e[0]+"]"),s=0;s<n.length;s++)n[s].value=e[1]}));const h=document.createElement("div");h.innerHTML=e.footer?e.footer:"",h.classList.add("drawflow-node-footer"),s.appendChild(i),s.appendChild(o),o.appendChild(l),o.appendChild(r),o.appendChild(c),s.appendChild(h),s.style.top=e.pos_y+"px",s.style.left=e.pos_x+"px",n.appendChild(s),this.precanvas.appendChild(n)}addRerouteImport(e){const t=this.reroute_width,n=this.reroute_fix_curvature,s=this.container;Object.keys(e.outputs).map((function(i,o){Object.keys(e.outputs[i].connections).map((function(o,l){const c=e.outputs[i].connections[o].points;void 0!==c&&c.forEach(((l,d)=>{const a=e.outputs[i].connections[o].node,r=e.outputs[i].connections[o].output,u=s.querySelector(".connection.node_in_node-"+a+".node_out_node-"+e.id+"."+i+"."+r);if(n&&0===d)for(var h=0;h<c.length;h++){var p=document.createElementNS("http://www.w3.org/2000/svg","path");p.classList.add("main-path"),p.setAttributeNS(null,"d",""),u.appendChild(p)}const m=document.createElementNS("http://www.w3.org/2000/svg","circle");m.classList.add("point");var f=l.pos_x,g=l.pos_y;m.setAttributeNS(null,"cx",f),m.setAttributeNS(null,"cy",g),m.setAttributeNS(null,"r",t),u.appendChild(m)}))}))}))}updateNodeValue(e){for(var t=e.target.attributes,n=0;n<t.length;n++)if(t[n].nodeName.startsWith("df-")){for(var s=t[n].nodeName.slice(3).split("-"),i=this.drawflow.drawflow[this.module].data[e.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,o=0;o<s.length-1;o+=1)null==i[s[o]]&&(i[s[o]]={}),i=i[s[o]];i[s[s.length-1]]=e.target.value}}updateNodeDataFromId(e,t){var n=this.getModuleFromNodeId(e);if(this.drawflow.drawflow[n].data[e].data=t,this.module===n){const n=this.container.querySelector("#node-"+e);let s=function(e,i,o){let l;l=null===e?t[i]:e[i],null!==l&&Object.entries(l).forEach((function(e,t){if("object"==typeof e[1])s(l,e[0],o+"-"+e[0]);else for(var i=n.querySelectorAll("[df-"+o+"-"+e[0]+"]"),c=0;c<i.length;c++)i[c].value=e[1]}))};Object.entries(t).forEach((function(e,t){if("object"==typeof e[1])s(null,e[0],e[0]);else for(var i=n.querySelectorAll("[df-"+e[0]+"]"),o=0;o<i.length;o++)i[o].value=e[1]}))}}addNodeInput(e,t,n=""){var s=this.getModuleFromNodeId(e);const i=this.getNodeFromId(e),o=Object.keys(i.inputs).length;if(this.module===s){const s=document.createElement("div");s.classList.add("input"),s.classList.add("input_"+(o+1)),t&&s.setAttribute("type",t);const i=document.createElement("div");i.classList.add("input-label"),i.classList.add("input-label_input_"+(o+1)),t&&i.setAttribute("type",t),n&&(i.innerHTML=n);const l=this.container.querySelector("#node-"+e+" .inputs");l.appendChild(s),l.appendChild(i),this.updateConnectionNodes("node-"+e)}this.drawflow.drawflow[s].data[e].inputs["input_"+(o+1)]={label:n,type:t,connections:[]}}changeNodeInputType(e,t,n,s){this.drawflow.drawflow[this.module].data[e].inputs[t].type=n,this.drawflow.drawflow[this.module].data[e].inputs[t].label=s,document.querySelector("#node-"+e+" ."+t).setAttribute("type",n),document.querySelector("#node-"+e+" .input-label_"+t).innerHTML=s;var i=this.drawflow.drawflow[this.module].data[e].inputs[t].connections[0];i&&!this.checkConnectionTypes(e,t,i.node,i.input)&&(console.log("Removeing invalid connection"),this.removeSingleConnection(i.node,e,i.input,t))}addNodeOutput(e,t,n=""){var s=this.getModuleFromNodeId(e);const i=this.getNodeFromId(e),o=Object.keys(i.outputs).length;if(this.module===s){const s=document.createElement("div");s.classList.add("output-label"),s.classList.add("output-label_output_"+(o+1)),t&&s.setAttribute("type",t),n&&(s.innerHTML=n);const i=document.createElement("div");i.classList.add("output"),i.classList.add("output_"+(o+1)),t&&i.setAttribute("type",t);const l=this.container.querySelector("#node-"+e+" .outputs");l.appendChild(s),l.appendChild(i),this.updateConnectionNodes("node-"+e)}this.drawflow.drawflow[s].data[e].outputs["output_"+(o+1)]={label:n,type:t,connections:[]}}changeNodeOutputType(e,t,n,s){this.drawflow.drawflow[this.module].data[e].outputs[t].type=n,this.drawflow.drawflow[this.module].data[e].outputs[t].type=s,document.querySelector("#node-"+e+" ."+t).setAttribute("type",n),document.querySelector("#node-"+e+" .output-label_"+t).innerHTML=s;var i=this.drawflow.drawflow[this.module].data[e].outputs[t].connections[0];i&&!this.checkConnectionTypes(e,t,i.node,i.output)&&(console.log("Removing invalid connection"),this.removeSingleConnection(i.node,e,i.output,t))}removeNodeInput(e,t){var n=this.getModuleFromNodeId(e);const s=this.getNodeFromId(e);this.module===n&&(this.container.querySelector("#node-"+e+" .inputs .input."+t).remove(),this.container.querySelector("#node-"+e+" .inputs .input-label.input-label_"+t).remove());const i=[];Object.keys(s.inputs[t].connections).map((function(n,o){const l=s.inputs[t].connections[o].node,c=s.inputs[t].connections[o].input;i.push({id_output:l,id:e,output_class:c,input_class:t})})),i.forEach(((e,t)=>{this.removeSingleConnection(e.id_output,e.id,e.output_class,e.input_class)})),delete this.drawflow.drawflow[n].data[e].inputs[t];const o=[],l=this.drawflow.drawflow[n].data[e].inputs;Object.keys(l).map((function(e,t){o.push(l[e])})),this.drawflow.drawflow[n].data[e].inputs={};const c=t.slice(6);let d=[];o.forEach(((t,s)=>{t.connections.forEach(((e,t)=>{d.push(e)})),this.drawflow.drawflow[n].data[e].inputs["input_"+(s+1)]=t})),d=new Set(d.map((e=>JSON.stringify(e)))),d=Array.from(d).map((e=>JSON.parse(e))),this.module===n&&this.container.querySelectorAll("#node-"+e+" .inputs .input").forEach(((e,t)=>{const n=e.classList[1].slice(6);parseInt(c)<parseInt(n)&&(e.classList.remove("input_"+n),e.classList.add("input_"+(n-1)))})),d.forEach(((t,s)=>{this.drawflow.drawflow[n].data[t.node].outputs[t.input].connections.forEach(((s,i)=>{if(s.node==e){const o=s.output.slice(6);if(parseInt(c)<parseInt(o)){if(this.module===n){const n=this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+t.node+"."+t.input+".input_"+o);n.classList.remove("input_"+o),n.classList.add("input_"+(o-1))}s.points?this.drawflow.drawflow[n].data[t.node].outputs[t.input].connections[i]={node:s.node,output:"input_"+(o-1),points:s.points}:this.drawflow.drawflow[n].data[t.node].outputs[t.input].connections[i]={node:s.node,output:"input_"+(o-1)}}}}))})),this.updateConnectionNodes("node-"+e)}removeNodeOutput(e,t){var n=this.getModuleFromNodeId(e);const s=this.getNodeFromId(e);this.module===n&&(this.container.querySelector("#node-"+e+" .outputs .output."+t).remove(),this.container.querySelector("#node-"+e+" .outputs .output-label.output-label_"+t).remove());const i=[];Object.keys(s.outputs[t].connections).map((function(n,o){const l=s.outputs[t].connections[o].node,c=s.outputs[t].connections[o].output;i.push({id:e,id_input:l,output_class:t,input_class:c})})),i.forEach(((e,t)=>{this.removeSingleConnection(e.id,e.id_input,e.output_class,e.input_class)})),delete this.drawflow.drawflow[n].data[e].outputs[t];const o=[],l=this.drawflow.drawflow[n].data[e].outputs;Object.keys(l).map((function(e,t){o.push(l[e])})),this.drawflow.drawflow[n].data[e].outputs={};const c=t.slice(7);let d=[];o.forEach(((t,s)=>{t.connections.forEach(((e,t)=>{d.push({node:e.node,output:e.output})})),this.drawflow.drawflow[n].data[e].outputs["output_"+(s+1)]=t})),d=new Set(d.map((e=>JSON.stringify(e)))),d=Array.from(d).map((e=>JSON.parse(e))),this.module===n&&this.container.querySelectorAll("#node-"+e+" .outputs .output").forEach(((e,t)=>{const n=e.classList[1].slice(7);parseInt(c)<parseInt(n)&&(e.classList.remove("output_"+n),e.classList.add("output_"+(n-1)))})),d.forEach(((t,s)=>{this.drawflow.drawflow[n].data[t.node].inputs[t.output].connections.forEach(((s,i)=>{if(s.node==e){const o=s.input.slice(7);if(parseInt(c)<parseInt(o)){if(this.module===n){const n=this.container.querySelector(".connection.node_in_node-"+t.node+".node_out_node-"+e+".output_"+o+"."+t.output);n.classList.remove("output_"+o),n.classList.remove(t.output),n.classList.add("output_"+(o-1)),n.classList.add(t.output)}s.points?this.drawflow.drawflow[n].data[t.node].inputs[t.output].connections[i]={node:s.node,input:"output_"+(o-1),points:s.points}:this.drawflow.drawflow[n].data[t.node].inputs[t.output].connections[i]={node:s.node,input:"output_"+(o-1)}}}}))})),this.updateConnectionNodes("node-"+e)}removeNodeId(e){this.removeConnectionNodeId(e);var t=this.getModuleFromNodeId(e.slice(5));this.module===t&&this.container.querySelector(`#${e}`).remove(),delete this.drawflow.drawflow[t].data[e.slice(5)],this.dispatch("nodeRemoved",e.slice(5))}removeConnection(){if(null!=this.connection_selected){var e=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var t=this.drawflow.drawflow[this.module].data[e[2].slice(14)].outputs[e[3]].connections.findIndex((function(t,n){return t.node===e[1].slice(13)&&t.output===e[4]}));this.drawflow.drawflow[this.module].data[e[2].slice(14)].outputs[e[3]].connections.splice(t,1);var n=this.drawflow.drawflow[this.module].data[e[1].slice(13)].inputs[e[4]].connections.findIndex((function(t,n){return t.node===e[2].slice(14)&&t.input===e[3]}));this.drawflow.drawflow[this.module].data[e[1].slice(13)].inputs[e[4]].connections.splice(n,1);var s=document.querySelector("#node-"+e[2].slice(14)+" ."+e[3]);s&&s.classList.contains("linked")&&0==document.querySelectorAll(".node_out_node-"+e[2].slice(14)+"."+e[3]).length&&s.classList.remove("linked");var i=document.querySelector("#node-"+e[1].slice(13)+" ."+e[4]);i&&i.classList.contains("linked")&&0==document.querySelectorAll(".node_in_node-"+e[1].slice(13)+"."+e[4]).length&&i.classList.remove("linked"),this.dispatch("connectionRemoved",{output_id:e[2].slice(14),input_id:e[1].slice(13),output_class:e[3],input_class:e[4]}),this.connection_selected=null}}removeSingleConnection(e,t,n,s){var i=this.getModuleFromNodeId(e);if(i===this.getModuleFromNodeId(t)){if(this.drawflow.drawflow[i].data[e].outputs[n].connections.findIndex((function(e,n){return e.node==t&&e.output===s}))>-1){this.module===i&&this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+e+"."+n+"."+s).remove();var o=this.drawflow.drawflow[i].data[e].outputs[n].connections.findIndex((function(e,n){return e.node==t&&e.output===s}));this.drawflow.drawflow[i].data[e].outputs[n].connections.splice(o,1);var l=this.drawflow.drawflow[i].data[t].inputs[s].connections.findIndex((function(t,s){return t.node==e&&t.input===n}));this.drawflow.drawflow[i].data[t].inputs[s].connections.splice(l,1);var c=document.querySelector("#node-"+e+" ."+n);c&&c.classList.contains("linked")&&0==document.querySelectorAll(".node_out_node-"+e+"."+n).length&&c.classList.remove("linked");var d=document.querySelector("#node-"+t+" ."+s);return d&&d.classList.contains("linked")&&0==document.querySelectorAll(".node_in_node-"+t+"."+s).length&&d.classList.remove("linked"),this.dispatch("connectionRemoved",{output_id:e,input_id:t,output_class:n,input_class:s}),!0}return!1}return!1}removeConnectionNodeId(e){const t="node_in_"+e,n="node_out_"+e,s=this.container.querySelectorAll(`.${n}`);for(let e=s.length-1;e>=0;e--){const t=s[e].classList,n=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex((function(e,n){return e.node===t[2].slice(14)&&e.input===t[3]}));this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(n,1);const i=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex((function(e,n){return e.node===t[1].slice(13)&&e.output===t[4]}));this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(i,1),s[e].remove();const o=document.querySelector("#node-"+t[2].slice(14)+" ."+t[3]);o&&o.classList.contains("linked")&&0==document.querySelectorAll(".node_out_node-"+t[2].slice(14)+"."+t[3]).length&&o.classList.remove("linked");const l=document.querySelector("#node-"+t[1].slice(13)+" ."+t[4]);l&&l.classList.contains("linked")&&0==document.querySelectorAll(".node_in_node-"+t[1].slice(13)+"."+t[4]).length&&l.classList.remove("linked"),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]})}const i=this.container.querySelectorAll(`.${t}`);for(let e=i.length-1;e>=0;e--){const t=i[e].classList,n=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex((function(e,n){return e.node===t[1].slice(13)&&e.output===t[4]}));this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(n,1);const s=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex((function(e,n){return e.node===t[2].slice(14)&&e.input===t[3]}));this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(s,1),i[e].remove();const o=document.querySelector("#node-"+t[2].slice(14)+" ."+t[3]);o&&o.classList.contains("linked")&&0==document.querySelectorAll(".node_out_node-"+t[2].slice(14)+"."+t[3]).length&&o.classList.remove("linked");const l=document.querySelector("#node-"+t[1].slice(13)+" ."+t[4]);l&&l.classList.contains("linked")&&0==document.querySelectorAll(".node_in_node-"+t[1].slice(13)+"."+t[4]).length&&l.classList.remove("linked"),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]})}}getModuleFromNodeId(e){var t;const n=this.drawflow.drawflow;return Object.keys(n).map((function(s,i){Object.keys(n[s].data).map((function(n,i){n==e&&(t=s)}))})),t}addModule(e){this.drawflow.drawflow[e]={data:{}},this.dispatch("moduleCreated",e)}changeModule(e){this.dispatch("moduleChanged",e),this.module=e,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow)}removeModule(e){this.module===e&&this.changeModule("Home"),delete this.drawflow.drawflow[e],this.dispatch("moduleRemoved",e)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const e={...this.drawflow};return this.dispatch("export",e),e}import(e){this.clear(),this.drawflow={...e},this.load(),this.dispatch("import","import")}on(e,t){return"function"!=typeof t?(console.error("The listener callback must be a function, the given type is "+typeof t),!1):"string"!=typeof e?(console.error("The event name must be a string, the given type is "+typeof e),!1):(void 0===this.events[e]&&(this.events[e]={listeners:[]}),void this.events[e].listeners.push(t))}removeListener(e,t){if(void 0===this.events[e])return!1;this.events[e].listeners=this.events[e].listeners.filter((e=>e.toString()!==t.toString()))}dispatch(e,t){if(void 0===this.events[e])return!1;this.events[e].listeners.forEach((e=>{e(t)}))}getUuid(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}}return t.default})()}));
//# sourceMappingURL=drawflow.min.js.map